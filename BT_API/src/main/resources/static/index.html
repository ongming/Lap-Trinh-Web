<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GraphQL Frontend</title>
</head>
<body>
    <h1>Products List</h1>
    <button onclick="fetchAllProductsSorted()">Load All Products (Sorted by Price)</button>
    <button onclick="fetchProductsByCategory(1)">Load Products by Category ID 1</button>
    <table id="productsTable" border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Quantity</th>
                <th>Description</th>
                <th>Price</th>
                <th>User ID</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        async function sendGraphQLQuery(query, variables = {}) {
            const response = await fetch('/graphql', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ query, variables })
            });
            const { data } = await response.json();
            return data;
        }

        async function fetchAllProductsSorted() {
            const query = `
                query {
                    allProductsSortedByPrice {
                        id
                        title
                        quantity
                        desc
                        price
                        user { id }
                    }
                }
            `;
            const data = await sendGraphQLQuery(query);
            renderProducts(data.allProductsSortedByPrice);
        }

        async function fetchProductsByCategory(categoryId) {
            const query = `
                query($id: ID!) {
                    productsByCategory(id: $id) {
                        id
                        title
                        quantity
                        desc
                        price
                        user { id }
                    }
                }
            `;
            const data = await sendGraphQLQuery(query, { id: categoryId });
            renderProducts(data.productsByCategory);
        }

        function renderProducts(products) {
            const tbody = document.querySelector('#productsTable tbody');
            tbody.innerHTML = '';
            products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.id}</td>
                    <td>${product.title}</td>
                    <td>${product.quantity}</td>
                    <td>${product.desc}</td>
                    <td>${product.price}</td>
                    <td>${product.user ? product.user.id : 'N/A'}</td>
                `;
                tbody.appendChild(row);
            });
        }
    </script>
</body>
</html>